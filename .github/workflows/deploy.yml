name: Deploy & Build
on:
  push:
    branches:
      - master
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:

      # clone
      - name: Checkout
        uses: actions/checkout@master

      # deploy
      - name: deploy
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HOST_NANJING2 }}
          username: ${{ secrets.DEPLOY_USER }}
          key: ${{ secrets.DEPLOY_KEY }}
          script: |
            cd /www/wwwroot/jx3box
            cd jx3box-facedat
            git pull origin master

      # cdn
      - name: OSS
        uses: manyuanrong/setup-ossutil@v2.0
        with:
          endpoint: "oss-cn-hangzhou.aliyuncs.com"
          access-key-id: ${{secrets.AccessKey_ID}}
          access-key-secret: ${{secrets.Access_Key_Secret}}
      - run: ossutil cp -rf assets/data/decal_std.json oss://jx3box/data/face
      - run: ossutil cp -rf assets/data/decal_origin.json oss://jx3box/data/face